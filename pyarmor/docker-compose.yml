version: '3.8'

services:
  pyarmor-encrypt:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: encrypt
    volumes:
      - ../app:/app/src       # æŒ‚è½½åŸå§‹ä»£ç ç›®å½•
      - ./encryption:/app/dist  # è¾“å‡ºåŠ å¯†ç»“æœåˆ°å®¿ä¸»æœº
    working_dir: /app
    command:
      - sh
      - -c
      - |
        echo "ğŸš€ å¼€å§‹åŠ å¯†..."
        pyarmor-7 obfuscate --recursive src/*.py --output dist --entry src/app.py
        rsync -avz --progress --exclude="*.py" --exclude="*.log" --exclude="*.env" --exclude="__pycache__/" --exclude="output*" src/ dist
        echo "âœ… åŠ å¯†å®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° ./encryption"

    restart: "on-failure:1"